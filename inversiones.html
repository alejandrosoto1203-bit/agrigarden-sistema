<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Módulo de Inversiones - Agrigarden</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: "#00e676", background: "#f8fafc" },
                    fontFamily: { sans: ["Manrope", "sans-serif"] },
                },
            },
        }
    </script>
    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Manrope', sans-serif;
        }

        .card {
            background: white;
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }

        .input-inv {
            background: #f1f5f9;
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem;
            font-weight: 600;
            width: 100%;
            font-size: 0.875rem;
        }

        .input-inv:focus {
            background: white;
            ring: 2px;
            ring-color: #00e676;
            outline: none;
        }
    </style>
</head>

<body class="min-h-screen text-[#1e293b] flex">

    <div id="sidebar-container"></div>

    <main class="flex-1 ml-64 p-8 space-y-8">
        <header class="flex justify-between items-center">
            <div>
                <nav class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Gestión Financiera /
                    Módulo de Inversiones</nav>
                <h1 class="text-3xl font-extrabold tracking-tight">Módulo de Inversiones</h1>
                <p class="text-gray-500 text-sm font-medium">Registre sus activos fijos y gastos de capital para el
                    cálculo automático.</p>
            </div>
            <div class="flex gap-3">
                <button
                    class="bg-white border border-gray-200 px-4 py-2.5 rounded-xl font-bold flex items-center gap-2 text-xs hover:bg-gray-50 transition-all">
                    <span class="material-symbols-outlined text-lg text-gray-400">download</span> Exportar
                </button>
                <button
                    class="bg-primary text-black px-4 py-2.5 rounded-xl font-bold flex items-center gap-2 text-xs shadow-lg shadow-primary/20">
                    <span class="material-symbols-outlined text-lg">add_circle</span> Nueva Inversión
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card p-6 relative overflow-hidden text-black font-black">
                <p class="text-gray-400 font-bold text-[10px] uppercase tracking-widest mb-2">Valor Total Invertido</p>
                <span id="totalInvertido" class="text-2xl font-extrabold text-slate-800">$0.00</span>
                <div class="mt-2 text-[10px] font-bold text-green-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-xs">trending_up</span> +12% este trimestre
                </div>
                <span class="material-symbols-outlined absolute top-6 right-6 text-green-400/30">payments</span>
            </div>
            <div class="card p-6 relative overflow-hidden">
                <p class="text-gray-400 font-bold text-[10px] uppercase tracking-widest mb-2">Ítems Activos</p>
                <span id="itemsActivos" class="text-2xl font-extrabold text-slate-800">0</span>
                <div class="mt-2 text-[10px] font-bold text-green-500 flex items-center gap-1">
                    <span class="material-symbols-outlined text-xs">add</span> 2 este mes
                </div>
                <span class="material-symbols-outlined absolute top-6 right-6 text-green-400/30">inventory_2</span>
            </div>
            <div class="card p-6 relative overflow-hidden">
                <p class="text-gray-400 font-bold text-[10px] uppercase tracking-widest mb-2">Depreciación Mensual Est.
                </p>
                <span id="depreciacionEst" class="text-2xl font-extrabold text-red-500">-$0.00</span>
                <div class="mt-2 text-[10px] font-bold text-red-400 flex items-center gap-1">
                    <span class="material-symbols-outlined text-xs">trending_up</span> +5.2% vs mes anterior
                </div>
                <span class="material-symbols-outlined absolute top-6 right-6 text-red-400/20">show_chart</span>
            </div>
        </div>

        <div class="grid grid-cols-12 gap-8">
            <div class="col-span-8 card overflow-hidden flex flex-col">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="font-bold text-sm uppercase tracking-tight">Listado de Activos</h2>
                    <div class="flex gap-2 bg-gray-50 rounded-lg border border-gray-100 p-1">
                        <select id="filtroSucursalInversion" onchange="aplicarFiltrosInversiones()"
                            class="bg-transparent border-none text-[10px] font-black uppercase text-gray-500 focus:ring-0">
                            <option value="Todos">Todas las Sucursales</option>
                            <option value="Matriz">Matriz</option>
                            <option value="Sucursal Norte">Norte</option>
                            <option value="Sucursal Sur">Sur</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 text-[10px] font-black uppercase text-gray-400 tracking-widest">
                            <tr>
                                <th class="px-6 py-4">Fecha</th>
                                <th class="px-6 py-4">Descripción</th>
                                <th class="px-6 py-4">Proveedor</th>
                                <th class="px-6 py-4 text-center">Categoría</th>
                                <th class="px-6 py-4 text-right">Monto</th>
                                <th class="px-6 py-4 text-center">Vida Útil</th>
                                <th class="px-6 py-4 text-center">Estatus</th>
                                <th class="px-6 py-4 text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaInversiones" class="divide-y divide-gray-50"></tbody>
                    </table>
                </div>
            </div>

            <aside class="col-span-4 card p-6 space-y-6 self-start sticky top-8">
                <div class="flex items-center gap-2 text-primary">
                    <span class="material-symbols-outlined font-bold">add_box</span>
                    <h2 class="font-extrabold text-sm uppercase tracking-tight text-black">Nueva Inversión</h2>
                </div>

                <form id="formInversion" class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Fecha de
                            Adquisición</label>
                        <input type="date" id="fechaInversion" class="input-inv" required>
                    </div>

                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Tipo de
                            Inversión</label>
                        <select id="tipoInversion" class="input-inv" onchange="toggleFinanciamiento(this.value)">
                            <option value="Compra Directa">Compra Directa</option>
                            <option value="Financiamiento">Financiamiento</option>
                            <option value="Arrendamiento">Arrendamiento</option>
                        </select>
                    </div>

                    <div id="camposFinanciamiento"
                        class="hidden space-y-4 bg-gray-50 p-3 rounded-xl border border-gray-100">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="space-y-1">
                                <label class="text-[9px] font-black text-blue-500 uppercase">Tasa Anual (%)</label>
                                <input type="number" step="0.01" id="tasaInversion" class="input-inv"
                                    placeholder="0.00">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[9px] font-black text-blue-500 uppercase">Plazo (Meses)</label>
                                <input type="number" id="plazoInversion" class="input-inv" placeholder="0">
                            </div>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-black text-blue-500 uppercase">Pago Mensual Est.</label>
                            <input type="number" step="0.01" id="pagoMensualInversion" class="input-inv"
                                placeholder="0.00">
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Descripción
                            del Activo</label>
                        <input type="text" id="descInversion" class="input-inv uppercase"
                            placeholder="Ej: Camioneta Operativa" required>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Monto
                                ($)</label>
                            <input type="number" step="0.01" id="montoInversion" class="input-inv font-bold"
                                placeholder="0.00" required>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Vida Útil
                                (Años)</label>
                            <input type="number" id="vidaInversion" class="input-inv font-bold" value="10">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Categoría</label>
                            <select id="catInversion" class="input-inv text-[10px]">
                                <option value="Terrenos y Propiedades">Terrenos y Propiedades</option>
                                <option value="Construcciones Mayores">Construcciones y Remodelaciones Mayores</option>
                                <option value="Vehículos Operativos">Vehículos Operativos</option>
                                <option value="Maquinaria (Renta)">Maquinaria y Equipo (para renta)</option>
                                <option value="Mobiliario">Mobiliario y Exhibición</option>
                                <option value="Tecnología">Tecnología y Sistemas</option>
                                <option value="Infraestructura Técnica">Infraestructura Técnica Permanente</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Sucursal</label>
                            <select id="sucursalInversion" class="input-inv text-[10px]">
                                <option value="Matriz">Matriz</option>
                                <option value="Sucursal Norte">Sucursal Norte</option>
                                <option value="Sucursal Sur">Sucursal Sur</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">Notas
                            Adicionales</label>
                        <textarea id="notasInversion" class="input-inv min-h-[80px] uppercase"
                            placeholder="Detalles adicionales..."></textarea>
                    </div>

                    <div class="space-y-3">
                        <div class="flex items-center gap-2 p-2 bg-green-50 rounded-lg border border-green-100">
                            <input type="checkbox" id="syncGasto" class="rounded text-primary focus:ring-primary">
                            <label for="syncGasto"
                                class="text-[9px] font-black text-green-700 uppercase cursor-pointer">Sincronizar con
                                módulo Gastos</label>
                        </div>

                        <div id="containerConfigSync"
                            class="hidden space-y-4 p-4 bg-gray-50 rounded-2xl border border-gray-200 animate-in fade-in zoom-in duration-200">
                            <div class="space-y-1">
                                <label class="text-[9px] font-black text-gray-400 uppercase ml-1">Proveedor del
                                    Activo</label>
                                <input type="text" id="proveedorInversion" class="input-inv uppercase"
                                    placeholder="Nombre del proveedor">
                            </div>

                            <div class="space-y-1">
                                <label class="text-[9px] font-black text-gray-400 uppercase ml-1">Método de Pago</label>
                                <select id="metodoPagoSync" class="input-inv"
                                    onchange="verificarMetodoSync(this.value)">
                                    <option value="Efectivo">Efectivo</option>
                                    <option value="Transferencia Hey Banco">Transferencia Hey Banco</option>
                                    <option value="Transferencia BBVA">Transferencia BBVA</option>
                                    <option value="Tarjeta de credito Hey Banco">Tarjeta de credito Hey Banco</option>
                                    <option value="Tarjeta de credito BBVA">Tarjeta de credito BBVA</option>
                                    <option value="Crédito">Crédito</option>
                                    <option value="Otros">Otros</option>
                                </select>
                            </div>

                            <div id="camposCreditoSync" class="hidden space-y-1">
                                <label class="text-[9px] font-black text-red-500 uppercase ml-1">Días de Crédito</label>
                                <input type="number" id="diasCreditoSync" class="input-inv" placeholder="30">
                            </div>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full bg-primary text-black font-black uppercase text-xs py-4 rounded-xl shadow-lg shadow-primary/20 hover:brightness-105 transition-all">
                        Guardar Inversión
                    </button>
                </form>
            </aside>
        </div>
    </main>

    <script src="api.js"></script>
    <script src="auth.js"></script>
    <script src="menu.js"></script>
    <script src="export_helper.js"></script>
    <script src="inversiones.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof inyectarMenu === 'function') inyectarMenu('inversiones');
            if (typeof cargarInversiones === 'function') cargarInversiones();

            const chkSync = document.getElementById('syncGasto');
            const containerSync = document.getElementById('containerConfigSync');

            chkSync?.addEventListener('change', (e) => {
                if (e.target.checked) {
                    containerSync.classList.remove('hidden');
                } else {
                    containerSync.classList.add('hidden');
                }
            });
        });

        function verificarMetodoSync(val) {
            const camposCredito = document.getElementById('camposCreditoSync');
            if (val === 'Crédito') {
                camposCredito.classList.remove('hidden');
            } else {
                camposCredito.classList.add('hidden');
            }
        }
    </script>
</body>

</html>